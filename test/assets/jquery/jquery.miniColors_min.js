jQuery&&function(d){d.extend(d.fn,{miniColors:function(j,k){var r=function(a){i(a);a.prop("disabled",!0).data("trigger").css("opacity",0.5)},w=function(a){if(a.prop("disabled"))return!1;i();var b=d('<div class="miniColors-selector"></div>');b.append('<div class="miniColors-colors" style="background-color: #FFF;"><div class="miniColors-colorPicker"></div></div>').append('<div class="miniColors-hues"><div class="miniColors-huePicker"></div></div>').css({top:a.is(":visible")?a.offset().top+a.outerHeight(): a.data("trigger").offset().top+a.data("trigger").outerHeight(),left:a.is(":visible")?a.offset().left:a.data("trigger").offset().left,display:"none"}).addClass(a.attr("class"));var e=a.data("hsb");b.find(".miniColors-colors").css("backgroundColor","#"+o(l({h:e.h,s:100,b:100})));var c=a.data("colorPosition");c||(c=s(e));b.find(".miniColors-colorPicker").css("top",c.y+"px").css("left",c.x+"px");(c=a.data("huePosition"))||(c=t(e));b.find(".miniColors-huePicker").css("top",c.y+"px");a.data("selector", b).data("huePicker",b.find(".miniColors-huePicker")).data("colorPicker",b.find(".miniColors-colorPicker")).data("mousebutton",0);d("BODY").append(b);b.fadeIn(100);b.bind("selectstart",function(){return!1});d(document).bind("mousedown.miniColors touchstart.miniColors",function(b){a.data("mousebutton",1);d(b.target).parents().andSelf().hasClass("miniColors-colors")&&(b.preventDefault(),a.data("moving","colors"),u(a,b));d(b.target).parents().andSelf().hasClass("miniColors-hues")&&(b.preventDefault(), a.data("moving","hues"),v(a,b));d(b.target).parents().andSelf().hasClass("miniColors-selector")?b.preventDefault():d(b.target).parents().andSelf().hasClass("miniColors")||i(a)});d(document).bind("mouseup.miniColors touchend.miniColors",function(b){b.preventDefault();a.data("mousebutton",0).removeData("moving")}).bind("mousemove.miniColors touchmove.miniColors",function(b){b.preventDefault();1===a.data("mousebutton")&&("colors"===a.data("moving")&&u(a,b),"hues"===a.data("moving")&&v(a,b))})},i=function(a){a|| (a=".miniColors");d(a).each(function(){var a=d(this).data("selector");d(this).removeData("selector");d(a).fadeOut(100,function(){d(this).remove()})});d(document).unbind(".miniColors")},u=function(a,b){var e=a.data("colorPicker");e.hide();var c={x:b.pageX,y:b.pageY};b.originalEvent.changedTouches&&(c.x=b.originalEvent.changedTouches[0].pageX,c.y=b.originalEvent.changedTouches[0].pageY);c.x=c.x-a.data("selector").find(".miniColors-colors").offset().left-5;c.y=c.y-a.data("selector").find(".miniColors-colors").offset().top- 5;-5>=c.x&&(c.x=-5);144<=c.x&&(c.x=144);-5>=c.y&&(c.y=-5);144<=c.y&&(c.y=144);a.data("colorPosition",c);e.css("left",c.x).css("top",c.y).show();e=Math.round(0.67*(c.x+5));0>e&&(e=0);100<e&&(e=100);c=100-Math.round(0.67*(c.y+5));0>c&&(c=0);100<c&&(c=100);var d=a.data("hsb");d.s=e;d.b=c;p(a,d,!0)},v=function(a,b){var e=a.data("huePicker");e.hide();var c={y:b.pageY};b.originalEvent.changedTouches&&(c.y=b.originalEvent.changedTouches[0].pageY);c.y=c.y-a.data("selector").find(".miniColors-colors").offset().top- 1;-1>=c.y&&(c.y=-1);149<=c.y&&(c.y=149);a.data("huePosition",c);e.css("top",c.y).show();e=Math.round(2.4*(150-c.y-1));0>e&&(e=0);360<e&&(e=360);c=a.data("hsb");c.h=e;p(a,c,!0)},p=function(a,b,e){a.data("hsb",b);var c=o(l(b));e&&a.val("#"+m(c,a.data("letterCase")));a.data("trigger").css("backgroundColor","#"+c);a.data("selector")&&a.data("selector").find(".miniColors-colors").css("backgroundColor","#"+o(l({h:b.h,s:100,b:100})));a.data("change")&&c!==a.data("lastChange")&&(a.data("change").call(a.get(0), "#"+c,l(b)),a.data("lastChange",c))},q=function(a){a.val("#"+x(a.val()));var b=n(a.val());if(!b)return!1;var b=y(b),e=a.data("hsb");if(b.h===e.h&&b.s===e.s&&b.b===e.b)return!0;e=s(b);d(a.data("colorPicker")).css("top",e.y+"px").css("left",e.x+"px");a.data("colorPosition",e);e=t(b);d(a.data("huePicker")).css("top",e.y+"px");a.data("huePosition",e);p(a,b);return!0},m=function(a,b){return"lowercase"===b?a.toLowerCase():"uppercase"===b?a.toUpperCase():a},s=function(a){var b=Math.ceil(a.s/0.67);0>b&&(b= 0);150<b&&(b=150);a=150-Math.ceil(a.b/0.67);0>a&&(a=0);150<a&&(a=150);return{x:b-5,y:a-5}},t=function(a){a=150-a.h/2.4;0>a&&(h=0);150<a&&(h=150);return{y:a-1}},x=function(a){return a.replace(/[^A-F0-9]/ig,"")},n=function(a){a=x(a);if(!a)return null;3===a.length&&(a=a[0]+a[0]+a[1]+a[1]+a[2]+a[2]);return 6===a.length?a:null},l=function(a){var b,e,c;b=Math.round(a.h);var d=Math.round(255*a.s/100),a=Math.round(255*a.b/100);if(0===d)b=e=c=a;else{var d=(255-d)*a/255,f=(a-d)*(b%60)/60;360===b&&(b=0);60> b?(b=a,c=d,e=d+f):120>b?(e=a,c=d,b=a-f):180>b?(e=a,b=d,c=d+f):240>b?(c=a,b=d,e=a-f):300>b?(c=a,e=d,b=d+f):360>b?(b=a,e=d,c=a-f):c=e=b=0}return{r:Math.round(b),g:Math.round(e),b:Math.round(c)}},o=function(a){var b=[a.r.toString(16),a.g.toString(16),a.b.toString(16)];d.each(b,function(a,c){1===c.length&&(b[a]="0"+c)});return b.join("")},y=function(a){var b=a,b=parseInt(-1<b.indexOf("#")?b.substring(1):b,16),a=b>>16,d=(b&65280)>>8,b=b&255,c={h:0,s:0,b:0},g=Math.min(a,d,b),f=Math.max(a,d,b),g=f-g;c.b= f;c.s=0!==f?255*g/f:0;c.h=0!==c.s?a===f?(d-b)/g:d===f?2+(b-a)/g:4+(a-d)/g:-1;c.h*=60;0>c.h&&(c.h+=360);c.s*=100/255;c.b*=100/255;0===c.s&&(c.h=360);return c};switch(j){case "readonly":return d(this).each(function(){d(this).hasClass("miniColors")&&d(this).prop("readonly",k)}),d(this);case "disabled":return d(this).each(function(){d(this).hasClass("miniColors")&&(k?r(d(this)):d(this).prop("disabled",!1).data("trigger").css("opacity",1))}),d(this);case "value":if(void 0===k){if(!d(this).hasClass("miniColors"))break; var z=d(this),A=n(z.val());return A?"#"+m(A,z.data("letterCase")):null}d(this).each(function(){d(this).hasClass("miniColors")&&(d(this).val(k),q(d(this)))});return d(this);case "destroy":return d(this).each(function(){if(d(this).hasClass("miniColors")){var a=d(this);i();a=d(a);a.data("trigger").remove();a.attr("autocomplete",a.data("original-autocomplete")).attr("maxlength",a.data("original-maxlength")).removeData().removeClass("miniColors").unbind(".miniColors");d(document).unbind(".miniColors")}}), d(this);default:return j||(j={}),d(this).each(function(){if("input"===d(this)[0].tagName.toLowerCase()&&!d(this).data("trigger")){var a=d(this),b=j,e=n(a.val());e||(e="ffffff");var c=y(e),g=d('<a class="miniColors-trigger" style="background-color: #'+e+'" href="#"></a>');g.insertAfter(a);a.addClass("miniColors").data("original-maxlength",a.attr("maxlength")||null).data("original-autocomplete",a.attr("autocomplete")||null).data("letterCase","uppercase").data("trigger",g).data("hsb",c).data("change", b.change?b.change:null).attr("maxlength",7).attr("autocomplete","off").val("#"+m(e,b.letterCase));b.readonly&&a.prop("readonly",!0);b.disabled&&r(a);g.bind("click.miniColors",function(b){b.preventDefault();""===a.val()&&a.val("#");w(a)});a.bind("focus.miniColors",function(){""===a.val()&&a.val("#");w(a)});a.bind("blur.miniColors",function(){var b=n(a.val());a.val(b?"#"+m(b,a.data("letterCase")):"")});a.bind("keydown.miniColors",function(b){9===b.keyCode&&i(a)});a.bind("keyup.miniColors",function(){q(a)}); a.bind("paste.miniColors",function(){setTimeout(function(){q(a)},5)})}}),d(this)}}})}(jQuery);